(function(M,te){typeof exports=="object"&&typeof module<"u"?te(exports):typeof define=="function"&&define.amd?define(["exports"],te):(M=typeof globalThis<"u"?globalThis:M||self,te(M.NeutralToken={}))})(this,function(M){"use strict";const _e={version:"0.1.1"};let ue=_e.version;if(typeof document<"u"){const n=document.currentScript?.src||"",i=n.match(/neutraltoken@(.*?)(\/|$)/);i&&i[1]?ue=i[1]:n.includes("@latest")&&(ue="latest")}const re=`https://cdn.jsdelivr.net/npm/neutraltoken@${ue}/dist`;function ht(n,i){return new Promise((c,a)=>{if(!document.getElementById("neutraltoken-css")){const p=document.createElement("link");p.id="neutraltoken-css",p.rel="stylesheet",p.href=`${re}/neutraltoken.css`,document.head.appendChild(p)}const l=document.createElement("div");l.className="pb-overlay",l.innerHTML=`
      <div class="pb-modal">
        <img src="${re}/logo.png" alt="NeutralToken logo" />
        <h2>Verify with NeutralToken</h2>
        <p>This site is requesting to verify your eligibility.</p>

        <button id="pb-accept" class="pb-button-primary">Continue</button>
        <button id="pb-cancel" class="pb-button-secondary">Cancel</button>

        <small>Issued by: <strong>sandbox.neutraltoken.org</strong></small>
      </div>
    `,document.body.appendChild(l),l.querySelector("#pb-accept")?.addEventListener("click",async()=>{try{const p=await i();d(),c(p)}catch(p){d(),a(p)}}),l.querySelector("#pb-cancel")?.addEventListener("click",()=>{d(),a(new Error("User cancelled"))});function d(){l.remove()}})}const fe=crypto,Te=n=>n instanceof CryptoKey,ne=new TextEncoder,ie=new TextDecoder;function lt(...n){const i=n.reduce((l,{length:d})=>l+d,0),c=new Uint8Array(i);let a=0;for(const l of n)c.set(l,a),a+=l.length;return c}const pt=n=>{const i=atob(n),c=new Uint8Array(i.length);for(let a=0;a<i.length;a++)c[a]=i.charCodeAt(a);return c},H=n=>{let i=n;i instanceof Uint8Array&&(i=ie.decode(i)),i=i.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return pt(i)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class U extends Error{constructor(i,c){super(i,c),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}U.code="ERR_JOSE_GENERIC";class D extends U{constructor(i,c,a="unspecified",l="unspecified"){super(i,{cause:{claim:a,reason:l,payload:c}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=a,this.reason=l,this.payload=c}}D.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class he extends U{constructor(i,c,a="unspecified",l="unspecified"){super(i,{cause:{claim:a,reason:l,payload:c}}),this.code="ERR_JWT_EXPIRED",this.claim=a,this.reason=l,this.payload=c}}he.code="ERR_JWT_EXPIRED";class Re extends U{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}Re.code="ERR_JOSE_ALG_NOT_ALLOWED";class O extends U{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}O.code="ERR_JOSE_NOT_SUPPORTED";class dt extends U{constructor(i="decryption operation failed",c){super(i,c),this.code="ERR_JWE_DECRYPTION_FAILED"}}dt.code="ERR_JWE_DECRYPTION_FAILED";class yt extends U{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}yt.code="ERR_JWE_INVALID";class F extends U{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}F.code="ERR_JWS_INVALID";class le extends U{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}le.code="ERR_JWT_INVALID";class wt extends U{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}wt.code="ERR_JWK_INVALID";class pe extends U{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}pe.code="ERR_JWKS_INVALID";class de extends U{constructor(i="no applicable key found in the JSON Web Key Set",c){super(i,c),this.code="ERR_JWKS_NO_MATCHING_KEY"}}de.code="ERR_JWKS_NO_MATCHING_KEY";class Fe extends U{constructor(i="multiple matching keys found in the JSON Web Key Set",c){super(i,c),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}Fe.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class Ce extends U{constructor(i="request timed out",c){super(i,c),this.code="ERR_JWKS_TIMEOUT"}}Ce.code="ERR_JWKS_TIMEOUT";class Ue extends U{constructor(i="signature verification failed",c){super(i,c),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}Ue.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";function k(n,i="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${i} must be ${n}`)}function Q(n,i){return n.name===i}function ye(n){return parseInt(n.name.slice(4),10)}function mt(n){switch(n){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Et(n,i){if(i.length&&!i.some(c=>n.usages.includes(c))){let c="CryptoKey does not support this operation, its usages must include ";if(i.length>2){const a=i.pop();c+=`one of ${i.join(", ")}, or ${a}.`}else i.length===2?c+=`one of ${i[0]} or ${i[1]}.`:c+=`${i[0]}.`;throw new TypeError(c)}}function gt(n,i,...c){switch(i){case"HS256":case"HS384":case"HS512":{if(!Q(n.algorithm,"HMAC"))throw k("HMAC");const a=parseInt(i.slice(2),10);if(ye(n.algorithm.hash)!==a)throw k(`SHA-${a}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Q(n.algorithm,"RSASSA-PKCS1-v1_5"))throw k("RSASSA-PKCS1-v1_5");const a=parseInt(i.slice(2),10);if(ye(n.algorithm.hash)!==a)throw k(`SHA-${a}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Q(n.algorithm,"RSA-PSS"))throw k("RSA-PSS");const a=parseInt(i.slice(2),10);if(ye(n.algorithm.hash)!==a)throw k(`SHA-${a}`,"algorithm.hash");break}case"EdDSA":{if(n.algorithm.name!=="Ed25519"&&n.algorithm.name!=="Ed448")throw k("Ed25519 or Ed448");break}case"Ed25519":{if(!Q(n.algorithm,"Ed25519"))throw k("Ed25519");break}case"ES256":case"ES384":case"ES512":{if(!Q(n.algorithm,"ECDSA"))throw k("ECDSA");const a=mt(i);if(n.algorithm.namedCurve!==a)throw k(a,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Et(n,c)}function We(n,i,...c){if(c=c.filter(Boolean),c.length>2){const a=c.pop();n+=`one of type ${c.join(", ")}, or ${a}.`}else c.length===2?n+=`one of type ${c[0]} or ${c[1]}.`:n+=`of type ${c[0]}.`;return i==null?n+=` Received ${i}`:typeof i=="function"&&i.name?n+=` Received function ${i.name}`:typeof i=="object"&&i!=null&&i.constructor?.name&&(n+=` Received an instance of ${i.constructor.name}`),n}const Ke=(n,...i)=>We("Key must be ",n,...i);function Pe(n,i,...c){return We(`Key for the ${n} algorithm must be `,i,...c)}const Je=n=>Te(n)?!0:n?.[Symbol.toStringTag]==="KeyObject",oe=["CryptoKey"],St=(...n)=>{const i=n.filter(Boolean);if(i.length===0||i.length===1)return!0;let c;for(const a of i){const l=Object.keys(a);if(!c||c.size===0){c=new Set(l);continue}for(const d of l){if(c.has(d))return!1;c.add(d)}}return!0};function xt(n){return typeof n=="object"&&n!==null}function v(n){if(!xt(n)||Object.prototype.toString.call(n)!=="[object Object]")return!1;if(Object.getPrototypeOf(n)===null)return!0;let i=n;for(;Object.getPrototypeOf(i)!==null;)i=Object.getPrototypeOf(i);return Object.getPrototypeOf(n)===i}const bt=(n,i)=>{if(n.startsWith("RS")||n.startsWith("PS")){const{modulusLength:c}=i.algorithm;if(typeof c!="number"||c<2048)throw new TypeError(`${n} requires key modulusLength to be 2048 bits or larger`)}};function V(n){return v(n)&&typeof n.kty=="string"}function At(n){return n.kty!=="oct"&&typeof n.d=="string"}function It(n){return n.kty!=="oct"&&typeof n.d>"u"}function Bt(n){return V(n)&&n.kty==="oct"&&typeof n.k=="string"}function _t(n){let i,c;switch(n.kty){case"RSA":{switch(n.alg){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:`SHA-${n.alg.slice(-3)}`},c=n.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.alg.slice(-3)}`},c=n.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:`SHA-${parseInt(n.alg.slice(-3),10)||1}`},c=n.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new O('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(n.alg){case"ES256":i={name:"ECDSA",namedCurve:"P-256"},c=n.d?["sign"]:["verify"];break;case"ES384":i={name:"ECDSA",namedCurve:"P-384"},c=n.d?["sign"]:["verify"];break;case"ES512":i={name:"ECDSA",namedCurve:"P-521"},c=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":i={name:"ECDH",namedCurve:n.crv},c=n.d?["deriveBits"]:[];break;default:throw new O('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(n.alg){case"Ed25519":i={name:"Ed25519"},c=n.d?["sign"]:["verify"];break;case"EdDSA":i={name:n.crv},c=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":i={name:n.crv},c=n.d?["deriveBits"]:[];break;default:throw new O('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new O('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:i,keyUsages:c}}const Ne=async n=>{if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:i,keyUsages:c}=_t(n),a=[i,n.ext??!1,n.key_ops??c],l={...n};return delete l.alg,delete l.use,fe.subtle.importKey("jwk",l,...a)},De=n=>H(n);let G,Y;const Oe=n=>n?.[Symbol.toStringTag]==="KeyObject",ce=async(n,i,c,a,l=!1)=>{let d=n.get(i);if(d?.[a])return d[a];const p=await Ne({...c,alg:a});return l&&Object.freeze(i),d?d[a]=p:n.set(i,{[a]:p}),p},Tt={normalizePublicKey:(n,i)=>{if(Oe(n)){let c=n.export({format:"jwk"});return delete c.d,delete c.dp,delete c.dq,delete c.p,delete c.q,delete c.qi,c.k?De(c.k):(Y||(Y=new WeakMap),ce(Y,n,c,i))}return V(n)?n.k?H(n.k):(Y||(Y=new WeakMap),ce(Y,n,n,i,!0)):n},normalizePrivateKey:(n,i)=>{if(Oe(n)){let c=n.export({format:"jwk"});return c.k?De(c.k):(G||(G=new WeakMap),ce(G,n,c,i))}return V(n)?n.k?H(n.k):(G||(G=new WeakMap),ce(G,n,n,i,!0)):n}};async function ke(n,i){if(!v(n))throw new TypeError("JWK must be an object");switch(i||(i=n.alg),n.kty){case"oct":if(typeof n.k!="string"||!n.k)throw new TypeError('missing "k" (Key Value) Parameter value');return H(n.k);case"RSA":if("oth"in n&&n.oth!==void 0)throw new O('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return Ne({...n,alg:i});default:throw new O('Unsupported "kty" (Key Type) Parameter value')}}const z=n=>n?.[Symbol.toStringTag],we=(n,i,c)=>{if(i.use!==void 0&&i.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(i.key_ops!==void 0&&i.key_ops.includes?.(c)!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${c}`);if(i.alg!==void 0&&i.alg!==n)throw new TypeError(`Invalid key for this operation, when present its alg must be ${n}`);return!0},Rt=(n,i,c,a)=>{if(!(i instanceof Uint8Array)){if(a&&V(i)){if(Bt(i)&&we(n,i,c))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Je(i))throw new TypeError(Pe(n,i,...oe,"Uint8Array",a?"JSON Web Key":null));if(i.type!=="secret")throw new TypeError(`${z(i)} instances for symmetric algorithms must be of type "secret"`)}},Ft=(n,i,c,a)=>{if(a&&V(i))switch(c){case"sign":if(At(i)&&we(n,i,c))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(It(i)&&we(n,i,c))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Je(i))throw new TypeError(Pe(n,i,...oe,a?"JSON Web Key":null));if(i.type==="secret")throw new TypeError(`${z(i)} instances for asymmetric algorithms must not be of type "secret"`);if(c==="sign"&&i.type==="public")throw new TypeError(`${z(i)} instances for asymmetric algorithm signing must be of type "private"`);if(c==="decrypt"&&i.type==="public")throw new TypeError(`${z(i)} instances for asymmetric algorithm decryption must be of type "private"`);if(i.algorithm&&c==="verify"&&i.type==="private")throw new TypeError(`${z(i)} instances for asymmetric algorithm verifying must be of type "public"`);if(i.algorithm&&c==="encrypt"&&i.type==="private")throw new TypeError(`${z(i)} instances for asymmetric algorithm encryption must be of type "public"`)};function Le(n,i,c,a){i.startsWith("HS")||i==="dir"||i.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(i)?Rt(i,c,a,n):Ft(i,c,a,n)}Le.bind(void 0,!1);const Me=Le.bind(void 0,!0);function Ct(n,i,c,a,l){if(l.crit!==void 0&&a?.crit===void 0)throw new n('"crit" (Critical) Header Parameter MUST be integrity protected');if(!a||a.crit===void 0)return new Set;if(!Array.isArray(a.crit)||a.crit.length===0||a.crit.some(p=>typeof p!="string"||p.length===0))throw new n('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let d;c!==void 0?d=new Map([...Object.entries(c),...i.entries()]):d=i;for(const p of a.crit){if(!d.has(p))throw new O(`Extension Header Parameter "${p}" is not recognized`);if(l[p]===void 0)throw new n(`Extension Header Parameter "${p}" is missing`);if(d.get(p)&&a[p]===void 0)throw new n(`Extension Header Parameter "${p}" MUST be integrity protected`)}return new Set(a.crit)}const Ut=(n,i)=>{if(i!==void 0&&(!Array.isArray(i)||i.some(c=>typeof c!="string")))throw new TypeError(`"${n}" option must be an array of strings`);if(i)return new Set(i)};function Wt(n,i){const c=`SHA-${n.slice(-3)}`;switch(n){case"HS256":case"HS384":case"HS512":return{hash:c,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:c,name:"RSA-PSS",saltLength:n.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:c,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:c,name:"ECDSA",namedCurve:i.namedCurve};case"Ed25519":return{name:"Ed25519"};case"EdDSA":return{name:i.name};default:throw new O(`alg ${n} is not supported either by JOSE or your javascript runtime`)}}async function Kt(n,i,c){if(i=await Tt.normalizePublicKey(i,n),Te(i))return gt(i,n,c),i;if(i instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError(Ke(i,...oe));return fe.subtle.importKey("raw",i,{hash:`SHA-${n.slice(-3)}`,name:"HMAC"},!1,[c])}throw new TypeError(Ke(i,...oe,"Uint8Array","JSON Web Key"))}const Pt=async(n,i,c,a)=>{const l=await Kt(n,i,"verify");bt(n,l);const d=Wt(n,l.algorithm);try{return await fe.subtle.verify(d,l,c,a)}catch{return!1}};async function Jt(n,i,c){if(!v(n))throw new F("Flattened JWS must be an object");if(n.protected===void 0&&n.header===void 0)throw new F('Flattened JWS must have either of the "protected" or "header" members');if(n.protected!==void 0&&typeof n.protected!="string")throw new F("JWS Protected Header incorrect type");if(n.payload===void 0)throw new F("JWS Payload missing");if(typeof n.signature!="string")throw new F("JWS Signature missing or incorrect type");if(n.header!==void 0&&!v(n.header))throw new F("JWS Unprotected Header incorrect type");let a={};if(n.protected)try{const x=H(n.protected);a=JSON.parse(ie.decode(x))}catch{throw new F("JWS Protected Header is invalid")}if(!St(a,n.header))throw new F("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const l={...a,...n.header},d=Ct(F,new Map([["b64",!0]]),c?.crit,a,l);let p=!0;if(d.has("b64")&&(p=a.b64,typeof p!="boolean"))throw new F('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:u}=l;if(typeof u!="string"||!u)throw new F('JWS "alg" (Algorithm) Header Parameter missing or invalid');const b=c&&Ut("algorithms",c.algorithms);if(b&&!b.has(u))throw new Re('"alg" (Algorithm) Header Parameter value not allowed');if(p){if(typeof n.payload!="string")throw new F("JWS Payload must be a string")}else if(typeof n.payload!="string"&&!(n.payload instanceof Uint8Array))throw new F("JWS Payload must be a string or an Uint8Array instance");let E=!1;typeof i=="function"?(i=await i(a,n),E=!0,Me(u,i,"verify"),V(i)&&(i=await ke(i,u))):Me(u,i,"verify");const w=lt(ne.encode(n.protected??""),ne.encode("."),typeof n.payload=="string"?ne.encode(n.payload):n.payload);let S;try{S=H(n.signature)}catch{throw new F("Failed to base64url decode the signature")}if(!await Pt(u,i,S,w))throw new Ue;let y;if(p)try{y=H(n.payload)}catch{throw new F("Failed to base64url decode the payload")}else typeof n.payload=="string"?y=ne.encode(n.payload):y=n.payload;const m={payload:y};return n.protected!==void 0&&(m.protectedHeader=a),n.header!==void 0&&(m.unprotectedHeader=n.header),E?{...m,key:i}:m}async function Nt(n,i,c){if(n instanceof Uint8Array&&(n=ie.decode(n)),typeof n!="string")throw new F("Compact JWS must be a string or Uint8Array");const{0:a,1:l,2:d,length:p}=n.split(".");if(p!==3)throw new F("Invalid Compact JWS");const u=await Jt({payload:l,protected:a,signature:d},i,c),b={payload:u.payload,protectedHeader:u.protectedHeader};return typeof i=="function"?{...b,key:u.key}:b}const Dt=n=>Math.floor(n.getTime()/1e3),ve=60,$e=ve*60,me=$e*24,Ot=me*7,kt=me*365.25,Lt=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,He=n=>{const i=Lt.exec(n);if(!i||i[4]&&i[1])throw new TypeError("Invalid time period format");const c=parseFloat(i[2]),a=i[3].toLowerCase();let l;switch(a){case"sec":case"secs":case"second":case"seconds":case"s":l=Math.round(c);break;case"minute":case"minutes":case"min":case"mins":case"m":l=Math.round(c*ve);break;case"hour":case"hours":case"hr":case"hrs":case"h":l=Math.round(c*$e);break;case"day":case"days":case"d":l=Math.round(c*me);break;case"week":case"weeks":case"w":l=Math.round(c*Ot);break;default:l=Math.round(c*kt);break}return i[1]==="-"||i[4]==="ago"?-l:l},qe=n=>n.toLowerCase().replace(/^application\//,""),Mt=(n,i)=>typeof n=="string"?i.includes(n):Array.isArray(n)?i.some(Set.prototype.has.bind(new Set(n))):!1,vt=(n,i,c={})=>{let a;try{a=JSON.parse(ie.decode(i))}catch{}if(!v(a))throw new le("JWT Claims Set must be a top-level JSON object");const{typ:l}=c;if(l&&(typeof n.typ!="string"||qe(n.typ)!==qe(l)))throw new D('unexpected "typ" JWT header value',a,"typ","check_failed");const{requiredClaims:d=[],issuer:p,subject:u,audience:b,maxTokenAge:E}=c,w=[...d];E!==void 0&&w.push("iat"),b!==void 0&&w.push("aud"),u!==void 0&&w.push("sub"),p!==void 0&&w.push("iss");for(const m of new Set(w.reverse()))if(!(m in a))throw new D(`missing required "${m}" claim`,a,m,"missing");if(p&&!(Array.isArray(p)?p:[p]).includes(a.iss))throw new D('unexpected "iss" claim value',a,"iss","check_failed");if(u&&a.sub!==u)throw new D('unexpected "sub" claim value',a,"sub","check_failed");if(b&&!Mt(a.aud,typeof b=="string"?[b]:b))throw new D('unexpected "aud" claim value',a,"aud","check_failed");let S;switch(typeof c.clockTolerance){case"string":S=He(c.clockTolerance);break;case"number":S=c.clockTolerance;break;case"undefined":S=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:N}=c,y=Dt(N||new Date);if((a.iat!==void 0||E)&&typeof a.iat!="number")throw new D('"iat" claim must be a number',a,"iat","invalid");if(a.nbf!==void 0){if(typeof a.nbf!="number")throw new D('"nbf" claim must be a number',a,"nbf","invalid");if(a.nbf>y+S)throw new D('"nbf" claim timestamp check failed',a,"nbf","check_failed")}if(a.exp!==void 0){if(typeof a.exp!="number")throw new D('"exp" claim must be a number',a,"exp","invalid");if(a.exp<=y-S)throw new he('"exp" claim timestamp check failed',a,"exp","check_failed")}if(E){const m=y-a.iat,x=typeof E=="number"?E:He(E);if(m-S>x)throw new he('"iat" claim timestamp check failed (too far in the past)',a,"iat","check_failed");if(m<0-S)throw new D('"iat" claim timestamp check failed (it should be in the past)',a,"iat","check_failed")}return a};async function $t(n,i,c){const a=await Nt(n,i,c);if(a.protectedHeader.crit?.includes("b64")&&a.protectedHeader.b64===!1)throw new le("JWTs MUST NOT use unencoded payload");const d={payload:vt(a.protectedHeader,a.payload,c),protectedHeader:a.protectedHeader};return typeof i=="function"?{...d,key:a.key}:d}function Ht(n){switch(typeof n=="string"&&n.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new O('Unsupported "alg" value for a JSON Web Key Set')}}function qt(n){return n&&typeof n=="object"&&Array.isArray(n.keys)&&n.keys.every(Vt)}function Vt(n){return v(n)}function Ve(n){return typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n))}class Gt{constructor(i){if(this._cached=new WeakMap,!qt(i))throw new pe("JSON Web Key Set malformed");this._jwks=Ve(i)}async getKey(i,c){const{alg:a,kid:l}={...i,...c?.header},d=Ht(a),p=this._jwks.keys.filter(E=>{let w=d===E.kty;if(w&&typeof l=="string"&&(w=l===E.kid),w&&typeof E.alg=="string"&&(w=a===E.alg),w&&typeof E.use=="string"&&(w=E.use==="sig"),w&&Array.isArray(E.key_ops)&&(w=E.key_ops.includes("verify")),w)switch(a){case"ES256":w=E.crv==="P-256";break;case"ES256K":w=E.crv==="secp256k1";break;case"ES384":w=E.crv==="P-384";break;case"ES512":w=E.crv==="P-521";break;case"Ed25519":w=E.crv==="Ed25519";break;case"EdDSA":w=E.crv==="Ed25519"||E.crv==="Ed448";break}return w}),{0:u,length:b}=p;if(b===0)throw new de;if(b!==1){const E=new Fe,{_cached:w}=this;throw E[Symbol.asyncIterator]=async function*(){for(const S of p)try{yield await Ge(w,S,a)}catch{}},E}return Ge(this._cached,u,a)}}async function Ge(n,i,c){const a=n.get(i)||n.set(i,{}).get(i);if(a[c]===void 0){const l=await ke({...i,ext:!0},c);if(l instanceof Uint8Array||l.type!=="public")throw new pe("JSON Web Key Set members must be public keys");a[c]=l}return a[c]}function Ye(n){const i=new Gt(n),c=async(a,l)=>i.getKey(a,l);return Object.defineProperties(c,{jwks:{value:()=>Ve(i._jwks),enumerable:!0,configurable:!1,writable:!1}}),c}const Yt=async(n,i,c)=>{let a,l,d=!1;typeof AbortController=="function"&&(a=new AbortController,l=setTimeout(()=>{d=!0,a.abort()},i));const p=await fetch(n.href,{signal:a?a.signal:void 0,redirect:"manual",headers:c.headers}).catch(u=>{throw d?new Ce:u});if(l!==void 0&&clearTimeout(l),p.status!==200)throw new U("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await p.json()}catch{throw new U("Failed to parse the JSON Web Key Set HTTP response as JSON")}};function zt(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}let Ee;(typeof navigator>"u"||!navigator.userAgent?.startsWith?.("Mozilla/5.0 "))&&(Ee="jose/v5.10.0");const ge=Symbol();function Xt(n,i){return!(typeof n!="object"||n===null||!("uat"in n)||typeof n.uat!="number"||Date.now()-n.uat>=i||!("jwks"in n)||!v(n.jwks)||!Array.isArray(n.jwks.keys)||!Array.prototype.every.call(n.jwks.keys,v))}class Zt{constructor(i,c){if(!(i instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(i.href),this._options={agent:c?.agent,headers:c?.headers},this._timeoutDuration=typeof c?.timeoutDuration=="number"?c?.timeoutDuration:5e3,this._cooldownDuration=typeof c?.cooldownDuration=="number"?c?.cooldownDuration:3e4,this._cacheMaxAge=typeof c?.cacheMaxAge=="number"?c?.cacheMaxAge:6e5,c?.[ge]!==void 0&&(this._cache=c?.[ge],Xt(c?.[ge],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=Ye(this._cache.jwks)))}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(i,c){(!this._local||!this.fresh())&&await this.reload();try{return await this._local(i,c)}catch(a){if(a instanceof de&&this.coolingDown()===!1)return await this.reload(),this._local(i,c);throw a}}async reload(){this._pendingFetch&&zt()&&(this._pendingFetch=void 0);const i=new Headers(this._options.headers);Ee&&!i.has("User-Agent")&&(i.set("User-Agent",Ee),this._options.headers=Object.fromEntries(i.entries())),this._pendingFetch||(this._pendingFetch=Yt(this._url,this._timeoutDuration,this._options).then(c=>{this._local=Ye(c),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=c),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(c=>{throw this._pendingFetch=void 0,c})),await this._pendingFetch}}function Qt(n,i){const c=new Zt(n,i),a=async(l,d)=>c.getKey(l,d);return Object.defineProperties(a,{coolingDown:{get:()=>c.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>c.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>c.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!c._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>c._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),a}async function Se(n,i={}){if(!n)throw new Error("No token provided");if(!i.issuer)throw new Error("issuer required");const c=new URL(i.issuer),a=new URL("/.well-known/jwks.json",c),l=Qt(a),{payload:d}=await $t(n,l,{issuer:i.issuer});if(d.exp&&d.exp*1e3<Date.now())throw new Error("Credential expired");return d}function jt(){return new Promise((n,i)=>{const c=window.prompt("Enter JWT badge");if(c)return n(c.trim());i(new Error("No token provided"))})}var xe={},j={},ze;function er(){if(ze)return j;ze=1,j.byteLength=u,j.toByteArray=E,j.fromByteArray=N;for(var n=[],i=[],c=typeof Uint8Array<"u"?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,d=a.length;l<d;++l)n[l]=a[l],i[a.charCodeAt(l)]=l;i[45]=62,i[95]=63;function p(y){var m=y.length;if(m%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var x=y.indexOf("=");x===-1&&(x=m);var W=x===m?0:4-x%4;return[x,W]}function u(y){var m=p(y),x=m[0],W=m[1];return(x+W)*3/4-W}function b(y,m,x){return(m+x)*3/4-x}function E(y){var m,x=p(y),W=x[0],K=x[1],R=new c(b(y,W,K)),P=0,q=K>0?W-4:W,T;for(T=0;T<q;T+=4)m=i[y.charCodeAt(T)]<<18|i[y.charCodeAt(T+1)]<<12|i[y.charCodeAt(T+2)]<<6|i[y.charCodeAt(T+3)],R[P++]=m>>16&255,R[P++]=m>>8&255,R[P++]=m&255;return K===2&&(m=i[y.charCodeAt(T)]<<2|i[y.charCodeAt(T+1)]>>4,R[P++]=m&255),K===1&&(m=i[y.charCodeAt(T)]<<10|i[y.charCodeAt(T+1)]<<4|i[y.charCodeAt(T+2)]>>2,R[P++]=m>>8&255,R[P++]=m&255),R}function w(y){return n[y>>18&63]+n[y>>12&63]+n[y>>6&63]+n[y&63]}function S(y,m,x){for(var W,K=[],R=m;R<x;R+=3)W=(y[R]<<16&16711680)+(y[R+1]<<8&65280)+(y[R+2]&255),K.push(w(W));return K.join("")}function N(y){for(var m,x=y.length,W=x%3,K=[],R=16383,P=0,q=x-W;P<q;P+=R)K.push(S(y,P,P+R>q?q:P+R));return W===1?(m=y[x-1],K.push(n[m>>2]+n[m<<4&63]+"==")):W===2&&(m=(y[x-2]<<8)+y[x-1],K.push(n[m>>10]+n[m>>4&63]+n[m<<2&63]+"=")),K.join("")}return j}var se={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var Xe;function tr(){return Xe||(Xe=1,se.read=function(n,i,c,a,l){var d,p,u=l*8-a-1,b=(1<<u)-1,E=b>>1,w=-7,S=c?l-1:0,N=c?-1:1,y=n[i+S];for(S+=N,d=y&(1<<-w)-1,y>>=-w,w+=u;w>0;d=d*256+n[i+S],S+=N,w-=8);for(p=d&(1<<-w)-1,d>>=-w,w+=a;w>0;p=p*256+n[i+S],S+=N,w-=8);if(d===0)d=1-E;else{if(d===b)return p?NaN:(y?-1:1)*(1/0);p=p+Math.pow(2,a),d=d-E}return(y?-1:1)*p*Math.pow(2,d-a)},se.write=function(n,i,c,a,l,d){var p,u,b,E=d*8-l-1,w=(1<<E)-1,S=w>>1,N=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=a?0:d-1,m=a?1:-1,x=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(u=isNaN(i)?1:0,p=w):(p=Math.floor(Math.log(i)/Math.LN2),i*(b=Math.pow(2,-p))<1&&(p--,b*=2),p+S>=1?i+=N/b:i+=N*Math.pow(2,1-S),i*b>=2&&(p++,b/=2),p+S>=w?(u=0,p=w):p+S>=1?(u=(i*b-1)*Math.pow(2,l),p=p+S):(u=i*Math.pow(2,S-1)*Math.pow(2,l),p=0));l>=8;n[c+y]=u&255,y+=m,u/=256,l-=8);for(p=p<<l|u,E+=l;E>0;n[c+y]=p&255,y+=m,p/=256,E-=8);n[c+y-m]|=x*128}),se}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Ze;function rr(){return Ze||(Ze=1,function(n){const i=er(),c=tr(),a=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=u,n.SlowBuffer=R,n.INSPECT_MAX_BYTES=50;const l=2147483647;n.kMaxLength=l,u.TYPED_ARRAY_SUPPORT=d(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function d(){try{const r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function p(r){if(r>l)throw new RangeError('The value "'+r+'" is invalid for option "size"');const e=new Uint8Array(r);return Object.setPrototypeOf(e,u.prototype),e}function u(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return S(r)}return b(r,e,t)}u.poolSize=8192;function b(r,e,t){if(typeof r=="string")return N(r,e);if(ArrayBuffer.isView(r))return m(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(L(r,ArrayBuffer)||r&&L(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(L(r,SharedArrayBuffer)||r&&L(r.buffer,SharedArrayBuffer)))return x(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const o=r.valueOf&&r.valueOf();if(o!=null&&o!==r)return u.from(o,e,t);const s=W(r);if(s)return s;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return u.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}u.from=function(r,e,t){return b(r,e,t)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array);function E(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function w(r,e,t){return E(r),r<=0?p(r):e!==void 0?typeof t=="string"?p(r).fill(e,t):p(r).fill(e):p(r)}u.alloc=function(r,e,t){return w(r,e,t)};function S(r){return E(r),p(r<0?0:K(r)|0)}u.allocUnsafe=function(r){return S(r)},u.allocUnsafeSlow=function(r){return S(r)};function N(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!u.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const t=P(r,e)|0;let o=p(t);const s=o.write(r,e);return s!==t&&(o=o.slice(0,s)),o}function y(r){const e=r.length<0?0:K(r.length)|0,t=p(e);for(let o=0;o<e;o+=1)t[o]=r[o]&255;return t}function m(r){if(L(r,Uint8Array)){const e=new Uint8Array(r);return x(e.buffer,e.byteOffset,e.byteLength)}return y(r)}function x(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let o;return e===void 0&&t===void 0?o=new Uint8Array(r):t===void 0?o=new Uint8Array(r,e):o=new Uint8Array(r,e,t),Object.setPrototypeOf(o,u.prototype),o}function W(r){if(u.isBuffer(r)){const e=K(r.length)|0,t=p(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||Be(r.length)?p(0):y(r);if(r.type==="Buffer"&&Array.isArray(r.data))return y(r.data)}function K(r){if(r>=l)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+l.toString(16)+" bytes");return r|0}function R(r){return+r!=r&&(r=0),u.alloc(+r)}u.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==u.prototype},u.compare=function(e,t){if(L(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),L(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let o=e.length,s=t.length;for(let f=0,h=Math.min(o,s);f<h;++f)if(e[f]!==t[f]){o=e[f],s=t[f];break}return o<s?-1:s<o?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return u.alloc(0);let o;if(t===void 0)for(t=0,o=0;o<e.length;++o)t+=e[o].length;const s=u.allocUnsafe(t);let f=0;for(o=0;o<e.length;++o){let h=e[o];if(L(h,Uint8Array))f+h.length>s.length?(u.isBuffer(h)||(h=u.from(h)),h.copy(s,f)):Uint8Array.prototype.set.call(s,h,f);else if(u.isBuffer(h))h.copy(s,f);else throw new TypeError('"list" argument must be an Array of Buffers');f+=h.length}return s};function P(r,e){if(u.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||L(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);const t=r.length,o=arguments.length>2&&arguments[2]===!0;if(!o&&t===0)return 0;let s=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return Ie(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return ft(r).length;default:if(s)return o?-1:Ie(r).length;e=(""+e).toLowerCase(),s=!0}}u.byteLength=P;function q(r,e,t){let o=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return dr(this,e,t);case"utf8":case"utf-8":return tt(this,e,t);case"ascii":return lr(this,e,t);case"latin1":case"binary":return pr(this,e,t);case"base64":return fr(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return yr(this,e,t);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),o=!0}}u.prototype._isBuffer=!0;function T(r,e,t){const o=r[e];r[e]=r[t],r[t]=o}u.prototype.swap16=function(){const e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)T(this,t,t+1);return this},u.prototype.swap32=function(){const e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)T(this,t,t+3),T(this,t+1,t+2);return this},u.prototype.swap64=function(){const e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)T(this,t,t+7),T(this,t+1,t+6),T(this,t+2,t+5),T(this,t+3,t+4);return this},u.prototype.toString=function(){const e=this.length;return e===0?"":arguments.length===0?tt(this,0,e):q.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:u.compare(this,e)===0},u.prototype.inspect=function(){let e="";const t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},a&&(u.prototype[a]=u.prototype.inspect),u.prototype.compare=function(e,t,o,s,f){if(L(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),o===void 0&&(o=e?e.length:0),s===void 0&&(s=0),f===void 0&&(f=this.length),t<0||o>e.length||s<0||f>this.length)throw new RangeError("out of range index");if(s>=f&&t>=o)return 0;if(s>=f)return-1;if(t>=o)return 1;if(t>>>=0,o>>>=0,s>>>=0,f>>>=0,this===e)return 0;let h=f-s,g=o-t;const B=Math.min(h,g),I=this.slice(s,f),_=e.slice(t,o);for(let A=0;A<B;++A)if(I[A]!==_[A]){h=I[A],g=_[A];break}return h<g?-1:g<h?1:0};function je(r,e,t,o,s){if(r.length===0)return-1;if(typeof t=="string"?(o=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,Be(t)&&(t=s?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(s)return-1;t=r.length-1}else if(t<0)if(s)t=0;else return-1;if(typeof e=="string"&&(e=u.from(e,o)),u.isBuffer(e))return e.length===0?-1:et(r,e,t,o,s);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?s?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):et(r,[e],t,o,s);throw new TypeError("val must be string, number or Buffer")}function et(r,e,t,o,s){let f=1,h=r.length,g=e.length;if(o!==void 0&&(o=String(o).toLowerCase(),o==="ucs2"||o==="ucs-2"||o==="utf16le"||o==="utf-16le")){if(r.length<2||e.length<2)return-1;f=2,h/=2,g/=2,t/=2}function B(_,A){return f===1?_[A]:_.readUInt16BE(A*f)}let I;if(s){let _=-1;for(I=t;I<h;I++)if(B(r,I)===B(e,_===-1?0:I-_)){if(_===-1&&(_=I),I-_+1===g)return _*f}else _!==-1&&(I-=I-_),_=-1}else for(t+g>h&&(t=h-g),I=t;I>=0;I--){let _=!0;for(let A=0;A<g;A++)if(B(r,I+A)!==B(e,A)){_=!1;break}if(_)return I}return-1}u.prototype.includes=function(e,t,o){return this.indexOf(e,t,o)!==-1},u.prototype.indexOf=function(e,t,o){return je(this,e,t,o,!0)},u.prototype.lastIndexOf=function(e,t,o){return je(this,e,t,o,!1)};function or(r,e,t,o){t=Number(t)||0;const s=r.length-t;o?(o=Number(o),o>s&&(o=s)):o=s;const f=e.length;o>f/2&&(o=f/2);let h;for(h=0;h<o;++h){const g=parseInt(e.substr(h*2,2),16);if(Be(g))return h;r[t+h]=g}return h}function cr(r,e,t,o){return ae(Ie(e,r.length-t),r,t,o)}function sr(r,e,t,o){return ae(gr(e),r,t,o)}function ar(r,e,t,o){return ae(ft(e),r,t,o)}function ur(r,e,t,o){return ae(Sr(e,r.length-t),r,t,o)}u.prototype.write=function(e,t,o,s){if(t===void 0)s="utf8",o=this.length,t=0;else if(o===void 0&&typeof t=="string")s=t,o=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(o)?(o=o>>>0,s===void 0&&(s="utf8")):(s=o,o=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const f=this.length-t;if((o===void 0||o>f)&&(o=f),e.length>0&&(o<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");let h=!1;for(;;)switch(s){case"hex":return or(this,e,t,o);case"utf8":case"utf-8":return cr(this,e,t,o);case"ascii":case"latin1":case"binary":return sr(this,e,t,o);case"base64":return ar(this,e,t,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ur(this,e,t,o);default:if(h)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),h=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function fr(r,e,t){return e===0&&t===r.length?i.fromByteArray(r):i.fromByteArray(r.slice(e,t))}function tt(r,e,t){t=Math.min(r.length,t);const o=[];let s=e;for(;s<t;){const f=r[s];let h=null,g=f>239?4:f>223?3:f>191?2:1;if(s+g<=t){let B,I,_,A;switch(g){case 1:f<128&&(h=f);break;case 2:B=r[s+1],(B&192)===128&&(A=(f&31)<<6|B&63,A>127&&(h=A));break;case 3:B=r[s+1],I=r[s+2],(B&192)===128&&(I&192)===128&&(A=(f&15)<<12|(B&63)<<6|I&63,A>2047&&(A<55296||A>57343)&&(h=A));break;case 4:B=r[s+1],I=r[s+2],_=r[s+3],(B&192)===128&&(I&192)===128&&(_&192)===128&&(A=(f&15)<<18|(B&63)<<12|(I&63)<<6|_&63,A>65535&&A<1114112&&(h=A))}}h===null?(h=65533,g=1):h>65535&&(h-=65536,o.push(h>>>10&1023|55296),h=56320|h&1023),o.push(h),s+=g}return hr(o)}const rt=4096;function hr(r){const e=r.length;if(e<=rt)return String.fromCharCode.apply(String,r);let t="",o=0;for(;o<e;)t+=String.fromCharCode.apply(String,r.slice(o,o+=rt));return t}function lr(r,e,t){let o="";t=Math.min(r.length,t);for(let s=e;s<t;++s)o+=String.fromCharCode(r[s]&127);return o}function pr(r,e,t){let o="";t=Math.min(r.length,t);for(let s=e;s<t;++s)o+=String.fromCharCode(r[s]);return o}function dr(r,e,t){const o=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>o)&&(t=o);let s="";for(let f=e;f<t;++f)s+=xr[r[f]];return s}function yr(r,e,t){const o=r.slice(e,t);let s="";for(let f=0;f<o.length-1;f+=2)s+=String.fromCharCode(o[f]+o[f+1]*256);return s}u.prototype.slice=function(e,t){const o=this.length;e=~~e,t=t===void 0?o:~~t,e<0?(e+=o,e<0&&(e=0)):e>o&&(e=o),t<0?(t+=o,t<0&&(t=0)):t>o&&(t=o),t<e&&(t=e);const s=this.subarray(e,t);return Object.setPrototypeOf(s,u.prototype),s};function C(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,o){e=e>>>0,t=t>>>0,o||C(e,t,this.length);let s=this[e],f=1,h=0;for(;++h<t&&(f*=256);)s+=this[e+h]*f;return s},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,o){e=e>>>0,t=t>>>0,o||C(e,t,this.length);let s=this[e+--t],f=1;for(;t>0&&(f*=256);)s+=this[e+--t]*f;return s},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e=e>>>0,t||C(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||C(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||C(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||C(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readBigUInt64LE=$(function(e){e=e>>>0,Z(e,"offset");const t=this[e],o=this[e+7];(t===void 0||o===void 0)&&ee(e,this.length-8);const s=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,f=this[++e]+this[++e]*2**8+this[++e]*2**16+o*2**24;return BigInt(s)+(BigInt(f)<<BigInt(32))}),u.prototype.readBigUInt64BE=$(function(e){e=e>>>0,Z(e,"offset");const t=this[e],o=this[e+7];(t===void 0||o===void 0)&&ee(e,this.length-8);const s=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],f=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+o;return(BigInt(s)<<BigInt(32))+BigInt(f)}),u.prototype.readIntLE=function(e,t,o){e=e>>>0,t=t>>>0,o||C(e,t,this.length);let s=this[e],f=1,h=0;for(;++h<t&&(f*=256);)s+=this[e+h]*f;return f*=128,s>=f&&(s-=Math.pow(2,8*t)),s},u.prototype.readIntBE=function(e,t,o){e=e>>>0,t=t>>>0,o||C(e,t,this.length);let s=t,f=1,h=this[e+--s];for(;s>0&&(f*=256);)h+=this[e+--s]*f;return f*=128,h>=f&&(h-=Math.pow(2,8*t)),h},u.prototype.readInt8=function(e,t){return e=e>>>0,t||C(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]},u.prototype.readInt16LE=function(e,t){e=e>>>0,t||C(e,2,this.length);const o=this[e]|this[e+1]<<8;return o&32768?o|4294901760:o},u.prototype.readInt16BE=function(e,t){e=e>>>0,t||C(e,2,this.length);const o=this[e+1]|this[e]<<8;return o&32768?o|4294901760:o},u.prototype.readInt32LE=function(e,t){return e=e>>>0,t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e=e>>>0,t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readBigInt64LE=$(function(e){e=e>>>0,Z(e,"offset");const t=this[e],o=this[e+7];(t===void 0||o===void 0)&&ee(e,this.length-8);const s=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(o<<24);return(BigInt(s)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)}),u.prototype.readBigInt64BE=$(function(e){e=e>>>0,Z(e,"offset");const t=this[e],o=this[e+7];(t===void 0||o===void 0)&&ee(e,this.length-8);const s=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(s)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+o)}),u.prototype.readFloatLE=function(e,t){return e=e>>>0,t||C(e,4,this.length),c.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e=e>>>0,t||C(e,4,this.length),c.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||C(e,8,this.length),c.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||C(e,8,this.length),c.read(this,e,!1,52,8)};function J(r,e,t,o,s,f){if(!u.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<f)throw new RangeError('"value" argument is out of bounds');if(t+o>r.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,o,s){if(e=+e,t=t>>>0,o=o>>>0,!s){const g=Math.pow(2,8*o)-1;J(this,e,t,o,g,0)}let f=1,h=0;for(this[t]=e&255;++h<o&&(f*=256);)this[t+h]=e/f&255;return t+o},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,o,s){if(e=+e,t=t>>>0,o=o>>>0,!s){const g=Math.pow(2,8*o)-1;J(this,e,t,o,g,0)}let f=o-1,h=1;for(this[t+f]=e&255;--f>=0&&(h*=256);)this[t+f]=e/h&255;return t+o},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,o){return e=+e,t=t>>>0,o||J(this,e,t,1,255,0),this[t]=e&255,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,o){return e=+e,t=t>>>0,o||J(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,o){return e=+e,t=t>>>0,o||J(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,o){return e=+e,t=t>>>0,o||J(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,o){return e=+e,t=t>>>0,o||J(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function nt(r,e,t,o,s){ut(e,o,s,r,t,7);let f=Number(e&BigInt(4294967295));r[t++]=f,f=f>>8,r[t++]=f,f=f>>8,r[t++]=f,f=f>>8,r[t++]=f;let h=Number(e>>BigInt(32)&BigInt(4294967295));return r[t++]=h,h=h>>8,r[t++]=h,h=h>>8,r[t++]=h,h=h>>8,r[t++]=h,t}function it(r,e,t,o,s){ut(e,o,s,r,t,7);let f=Number(e&BigInt(4294967295));r[t+7]=f,f=f>>8,r[t+6]=f,f=f>>8,r[t+5]=f,f=f>>8,r[t+4]=f;let h=Number(e>>BigInt(32)&BigInt(4294967295));return r[t+3]=h,h=h>>8,r[t+2]=h,h=h>>8,r[t+1]=h,h=h>>8,r[t]=h,t+8}u.prototype.writeBigUInt64LE=$(function(e,t=0){return nt(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=$(function(e,t=0){return it(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(e,t,o,s){if(e=+e,t=t>>>0,!s){const B=Math.pow(2,8*o-1);J(this,e,t,o,B-1,-B)}let f=0,h=1,g=0;for(this[t]=e&255;++f<o&&(h*=256);)e<0&&g===0&&this[t+f-1]!==0&&(g=1),this[t+f]=(e/h>>0)-g&255;return t+o},u.prototype.writeIntBE=function(e,t,o,s){if(e=+e,t=t>>>0,!s){const B=Math.pow(2,8*o-1);J(this,e,t,o,B-1,-B)}let f=o-1,h=1,g=0;for(this[t+f]=e&255;--f>=0&&(h*=256);)e<0&&g===0&&this[t+f+1]!==0&&(g=1),this[t+f]=(e/h>>0)-g&255;return t+o},u.prototype.writeInt8=function(e,t,o){return e=+e,t=t>>>0,o||J(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1},u.prototype.writeInt16LE=function(e,t,o){return e=+e,t=t>>>0,o||J(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,o){return e=+e,t=t>>>0,o||J(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2},u.prototype.writeInt32LE=function(e,t,o){return e=+e,t=t>>>0,o||J(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,o){return e=+e,t=t>>>0,o||J(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4},u.prototype.writeBigInt64LE=$(function(e,t=0){return nt(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=$(function(e,t=0){return it(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ot(r,e,t,o,s,f){if(t+o>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function ct(r,e,t,o,s){return e=+e,t=t>>>0,s||ot(r,e,t,4),c.write(r,e,t,o,23,4),t+4}u.prototype.writeFloatLE=function(e,t,o){return ct(this,e,t,!0,o)},u.prototype.writeFloatBE=function(e,t,o){return ct(this,e,t,!1,o)};function st(r,e,t,o,s){return e=+e,t=t>>>0,s||ot(r,e,t,8),c.write(r,e,t,o,52,8),t+8}u.prototype.writeDoubleLE=function(e,t,o){return st(this,e,t,!0,o)},u.prototype.writeDoubleBE=function(e,t,o){return st(this,e,t,!1,o)},u.prototype.copy=function(e,t,o,s){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(o||(o=0),!s&&s!==0&&(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<o&&(s=o),s===o||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(o<0||o>=this.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-o&&(s=e.length-t+o);const f=s-o;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,o,s):Uint8Array.prototype.set.call(e,this.subarray(o,s),t),f},u.prototype.fill=function(e,t,o,s){if(typeof e=="string"){if(typeof t=="string"?(s=t,t=0,o=this.length):typeof o=="string"&&(s=o,o=this.length),s!==void 0&&typeof s!="string")throw new TypeError("encoding must be a string");if(typeof s=="string"&&!u.isEncoding(s))throw new TypeError("Unknown encoding: "+s);if(e.length===1){const h=e.charCodeAt(0);(s==="utf8"&&h<128||s==="latin1")&&(e=h)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<o)throw new RangeError("Out of range index");if(o<=t)return this;t=t>>>0,o=o===void 0?this.length:o>>>0,e||(e=0);let f;if(typeof e=="number")for(f=t;f<o;++f)this[f]=e;else{const h=u.isBuffer(e)?e:u.from(e,s),g=h.length;if(g===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(f=0;f<o-t;++f)this[f+t]=h[f%g]}return this};const X={};function Ae(r,e,t){X[r]=class extends t{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(s){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:s,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}Ae("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ae("ERR_INVALID_ARG_TYPE",function(r,e){return`The "${r}" argument must be of type number. Received type ${typeof e}`},TypeError),Ae("ERR_OUT_OF_RANGE",function(r,e,t){let o=`The value of "${r}" is out of range.`,s=t;return Number.isInteger(t)&&Math.abs(t)>2**32?s=at(String(t)):typeof t=="bigint"&&(s=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(s=at(s)),s+="n"),o+=` It must be ${e}. Received ${s}`,o},RangeError);function at(r){let e="",t=r.length;const o=r[0]==="-"?1:0;for(;t>=o+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function wr(r,e,t){Z(e,"offset"),(r[e]===void 0||r[e+t]===void 0)&&ee(e,r.length-(t+1))}function ut(r,e,t,o,s,f){if(r>t||r<e){const h=typeof e=="bigint"?"n":"";let g;throw e===0||e===BigInt(0)?g=`>= 0${h} and < 2${h} ** ${(f+1)*8}${h}`:g=`>= -(2${h} ** ${(f+1)*8-1}${h}) and < 2 ** ${(f+1)*8-1}${h}`,new X.ERR_OUT_OF_RANGE("value",g,r)}wr(o,s,f)}function Z(r,e){if(typeof r!="number")throw new X.ERR_INVALID_ARG_TYPE(e,"number",r)}function ee(r,e,t){throw Math.floor(r)!==r?(Z(r,t),new X.ERR_OUT_OF_RANGE("offset","an integer",r)):e<0?new X.ERR_BUFFER_OUT_OF_BOUNDS:new X.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${e}`,r)}const mr=/[^+/0-9A-Za-z-_]/g;function Er(r){if(r=r.split("=")[0],r=r.trim().replace(mr,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function Ie(r,e){e=e||1/0;let t;const o=r.length;let s=null;const f=[];for(let h=0;h<o;++h){if(t=r.charCodeAt(h),t>55295&&t<57344){if(!s){if(t>56319){(e-=3)>-1&&f.push(239,191,189);continue}else if(h+1===o){(e-=3)>-1&&f.push(239,191,189);continue}s=t;continue}if(t<56320){(e-=3)>-1&&f.push(239,191,189),s=t;continue}t=(s-55296<<10|t-56320)+65536}else s&&(e-=3)>-1&&f.push(239,191,189);if(s=null,t<128){if((e-=1)<0)break;f.push(t)}else if(t<2048){if((e-=2)<0)break;f.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;f.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;f.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return f}function gr(r){const e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function Sr(r,e){let t,o,s;const f=[];for(let h=0;h<r.length&&!((e-=2)<0);++h)t=r.charCodeAt(h),o=t>>8,s=t%256,f.push(s),f.push(o);return f}function ft(r){return i.toByteArray(Er(r))}function ae(r,e,t,o){let s;for(s=0;s<o&&!(s+t>=e.length||s>=r.length);++s)e[s+t]=r[s];return s}function L(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name}function Be(r){return r!==r}const xr=function(){const r="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){const o=t*16;for(let s=0;s<16;++s)e[o+s]=r[t]+r[s]}return e}();function $(r){return typeof BigInt>"u"?br:r}function br(){throw new Error("BigInt not supported")}}(xe)),xe}var nr=rr();const ir={};console.log(`📦 NeutralToken v${_e.version} loaded`),typeof window<"u"&&(window.Buffer||(window.Buffer=nr.Buffer),window.process||(window.process=ir));function Qe(n,i={}){if(!document.getElementById("neutraltoken-css")){const l=document.createElement("link");l.id="neutraltoken-css",l.rel="stylesheet",l.href=`${re}/neutraltoken.css`,document.head.appendChild(l)}const c=typeof n=="string"?document.querySelector(n):n;if(!c){console.error("NeutralToken: renderButton target not found.");return}const a=document.createElement("button");a.className="verify-button",a.innerHTML=`
    <img src="${re}/logo.png" alt="Verify with NeutralToken" />
    <span>Verify with NeutralToken</span>
  `,a.addEventListener("click",()=>{be(i).then(l=>{console.log("✅ Badge verified",l),typeof i.onSuccess=="function"&&i.onSuccess(l)}).catch(l=>{console.error("❌ Badge verification failed",l),typeof i.onError=="function"&&i.onError(l)})}),c.appendChild(a)}function be(n={}){return new Promise(async(i,c)=>{try{n.token?console.log("🪵 Using provided token from config:",n.token):console.log("🪵 No token provided. Launching modal...");const a=n.token?n.token:await ht(n,async()=>(console.log("🪵 Inside modal callback — calling requestFromWallet"),await jt(n)));console.log("🪵 Token acquired:",a);const l=await Se(a,n);console.log("🪵 Payload verified:",l),i(l)}catch(a){console.error("❌ requestBadge error:",a),c(a)}})}typeof window<"u"&&(window.NeutralToken={requestBadge:be,verifyBadge:Se,renderButton:Qe}),M.renderButton=Qe,M.requestBadge=be,M.verifyBadge=Se,Object.defineProperty(M,Symbol.toStringTag,{value:"Module"})});
